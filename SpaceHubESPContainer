local CoreGui = game.CoreGui
local RunService = game:GetService("RunService")

-- ESP

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local Camera = workspace.CurrentCamera

local SpaceHubESPFolder = Instance.new("Folder")
SpaceHubESPFolder.Name = "SpaceHubESP"
SpaceHubESPFolder.Parent = CoreGui

-- Rocket

local ROCKET_LINE_THICKNESS = 1
local ROCKET_OFFSET_Y = 40

for _, RocketGuiName in ipairs({ "RocketLines", "RocketBoxes", "RocketNames" }) do
	local RocketOldGui = CoreGui:FindFirstChild(RocketGuiName)
	if RocketOldGui then
		RocketOldGui:Destroy()
	end
end

local RocketLineGui = Instance.new("ScreenGui")
RocketLineGui.Name = "RocketLines"
RocketLineGui.IgnoreGuiInset = true
RocketLineGui.DisplayOrder = 1000
RocketLineGui.ResetOnSpawn = false
RocketLineGui.Parent = SpaceHubESPFolder
RocketLineGui.Enabled = false
RocketLineGui.Enabled = false

local RocketBoxGui = Instance.new("ScreenGui")
RocketBoxGui.Name = "RocketBoxes"
RocketBoxGui.IgnoreGuiInset = true
RocketBoxGui.DisplayOrder = 1001
RocketBoxGui.ResetOnSpawn = false
RocketBoxGui.Parent = SpaceHubESPFolder
RocketBoxGui.Enabled = false

local RocketNameGui = Instance.new("ScreenGui")
RocketNameGui.Name = "RocketNames"
RocketNameGui.IgnoreGuiInset = true
RocketNameGui.DisplayOrder = 1002
RocketNameGui.ResetOnSpawn = false
RocketNameGui.Parent = SpaceHubESPFolder
RocketNameGui.Enabled = false

local RocketTrackedModels = {}

local function makeRocketLine()
	local RocketLine = Instance.new("Frame")
	RocketLine.Size = UDim2.fromOffset(10, ROCKET_LINE_THICKNESS)
	RocketLine.AnchorPoint = Vector2.new(0.5, 0.5)
	RocketLine.BorderSizePixel = 0
	RocketLine.BackgroundColor3 = Color3.fromRGB(255,255,255)
	RocketLine.Visible = false
	RocketLine.Parent = RocketLineGui
	return RocketLine
end

local function makeRocketBox()
	local RocketBox = Instance.new("Frame")
	RocketBox.AnchorPoint = Vector2.new(0.5, 0.5)
	RocketBox.BackgroundTransparency = 1
	RocketBox.Visible = false
	RocketBox.Parent = RocketBoxGui

	local RocketBoxAspect = Instance.new("UIAspectRatioConstraint")
	RocketBoxAspect.AspectRatio = 1
	RocketBoxAspect.Parent = RocketBox

	local RocketBoxStroke = Instance.new("UIStroke")
	RocketBoxStroke.Thickness = 1.5
	RocketBoxStroke.Color = Color3.fromRGB(255,255,255)
	RocketBoxStroke.Parent = RocketBox

	return RocketBox
end

local function makeRocketNameLabel()
	local RocketNameLabel = Instance.new("TextLabel")
	RocketNameLabel.AnchorPoint = Vector2.new(0.5, 1)
	RocketNameLabel.BackgroundTransparency = 1
	RocketNameLabel.TextColor3 = Color3.fromRGB(255,255,255)
	RocketNameLabel.TextScaled = true
	RocketNameLabel.Font = Enum.Font.Gotham
	RocketNameLabel.Visible = false
	RocketNameLabel.Parent = RocketNameGui

	local RocketNameAspect = Instance.new("UIAspectRatioConstraint")
	RocketNameAspect.AspectRatio = 5
	RocketNameAspect.Parent = RocketNameLabel

	return RocketNameLabel
end

local function getModelPosition(model)
	local main = model:FindFirstChild("Main")
	if main and main:IsA("BasePart") then
		return main.Position
	end
	local cf,_ = model:GetBoundingBox()
	return cf.Position
end

local function addRocketModel(model)
	if model:IsA("Model") and not RocketTrackedModels[model] then
		RocketTrackedModels[model] = {
			RocketLine = makeRocketLine(),
			RocketBox = makeRocketBox(),
			RocketNameLabel = makeRocketNameLabel()
		}
	end
end

local function bindRockets(rockets)
	for _, m in ipairs(rockets:GetChildren()) do
		addRocketModel(m)
	end
	rockets.ChildAdded:Connect(addRocketModel)
end

local rockets = workspace:FindFirstChild("Rockets")
if rockets then
	bindRockets(rockets)
end

workspace.ChildAdded:Connect(function(obj)
	if obj.Name == "Rockets" then
		bindRockets(obj)
	end
end)

RunService.RenderStepped:Connect(function()
	local RocketViewport = Camera.ViewportSize
	local RocketSourceX = RocketViewport.X / 2
	local RocketSourceY = ROCKET_OFFSET_Y

	for model, RocketData in pairs(RocketTrackedModels) do
		local RocketLine = RocketData.RocketLine
		local RocketBox = RocketData.RocketBox
		local RocketNameLabel = RocketData.RocketNameLabel

		local localPlayerSeat = LocalPlayer.Character
			and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
			and LocalPlayer.Character:FindFirstChildOfClass("Humanoid").SeatPart
		local hideForLocal = localPlayerSeat and localPlayerSeat:IsDescendantOf(model)

		if model.Parent and not hideForLocal then
			local RocketWorldPos = getModelPosition(model)
			local RocketScreenPos, RocketVisible = Camera:WorldToViewportPoint(RocketWorldPos)

			if RocketVisible then
				local RocketDX = RocketScreenPos.X - RocketSourceX
				local RocketDY = RocketScreenPos.Y - RocketSourceY
				local RocketDistance = math.sqrt(RocketDX^2 + RocketDY^2)

				RocketLine.Visible = true
				RocketLine.Size = UDim2.fromOffset(RocketDistance, ROCKET_LINE_THICKNESS)
				RocketLine.Position = UDim2.fromOffset((RocketScreenPos.X + RocketSourceX)/2, (RocketScreenPos.Y + RocketSourceY)/2)
				RocketLine.Rotation = math.deg(math.atan2(RocketDY, RocketDX))

				local RocketScale = math.clamp(RocketScreenPos.Z / 400, 0.01, 0.045)
				RocketBox.Visible = true
				RocketBox.Position = UDim2.fromOffset(RocketScreenPos.X, RocketScreenPos.Y)
				RocketBox.Size = UDim2.fromScale(RocketScale, RocketScale)

				local launchMode = model:GetAttribute("launchMode")
				local isShuttle = model:GetAttribute("destinationNum") ~= nil
				local color = Color3.fromRGB(255,255,255)

				if launchMode then
					color = Color3.fromRGB(255,255,0)
				elseif isShuttle then
					color = Color3.fromRGB(0,170,255)
				end

				RocketLine.BackgroundColor3 = color
				if RocketBox:FindFirstChildWhichIsA("UIStroke") then
					RocketBox:FindFirstChildWhichIsA("UIStroke").Color = color
				end

				if RocketNameLabel then
					local RocketDistText = math.floor((Camera.CFrame.Position - RocketWorldPos).Magnitude)
					local RocketText

					if isShuttle then
						RocketText = "Shuttle | "..RocketDistText.." studs"
					elseif launchMode then
						local ownerName = "No One Owned"
						local ownerId = model:GetAttribute("lastPilotId")
						if ownerId and ownerId ~= 0 then
							local player = Players:GetPlayerByUserId(ownerId)
							if player then
								ownerName = player.DisplayName
							end
						end
						RocketText = ownerName.."'s Ship | "..RocketDistText.." studs | Launching"
					else
						local ownerName = "No One Owned"
						local ownerId = model:GetAttribute("lastPilotId")
						if ownerId and ownerId ~= 0 then
							local player = Players:GetPlayerByUserId(ownerId)
							if player then
								ownerName = player.DisplayName
							end
						end
						RocketText = ownerName.."'s Ship | "..RocketDistText.." studs"
					end

					RocketNameLabel.Text = RocketText
					RocketNameLabel.Position = UDim2.fromOffset(RocketScreenPos.X, RocketScreenPos.Y - 10)
					local RocketLabelScale = math.clamp(RocketScreenPos.Z / 400, 0.1, 0.1)
					RocketNameLabel.Size = UDim2.fromScale(RocketLabelScale, RocketLabelScale)
					RocketNameLabel.Visible = true
				end
			else
				RocketLine.Visible = false
				RocketBox.Visible = false
				if RocketNameLabel then RocketNameLabel.Visible = false end
			end
		else
			RocketLine.Visible = false
			RocketBox.Visible = false
			if RocketNameLabel then RocketNameLabel.Visible = false end
		end
	end
end)


-- UFO

local UFO_LINE_THICKNESS = 1
local UFO_OFFSET_Y = 40
local UFO_DEFAULT_COLOR = Color3.fromRGB(0, 200, 0)

for _, UFOGuiName in ipairs({ "UFOLines", "UFOBoxes", "UFONames" }) do
	local UFOOldGui = CoreGui:FindFirstChild(UFOGuiName)
	if UFOOldGui then
		UFOOldGui:Destroy()
	end
end

local UFOLineGui = Instance.new("ScreenGui")
UFOLineGui.Name = "UFOLines"
UFOLineGui.IgnoreGuiInset = true
UFOLineGui.DisplayOrder = 1000
UFOLineGui.ResetOnSpawn = false
UFOLineGui.Parent = SpaceHubESPFolder
UFOLineGui.Enabled = false

local UFOBoxGui = Instance.new("ScreenGui")
UFOBoxGui.Name = "UFOBoxes"
UFOBoxGui.IgnoreGuiInset = true
UFOBoxGui.DisplayOrder = 1001
UFOBoxGui.ResetOnSpawn = false
UFOBoxGui.Parent = SpaceHubESPFolder
UFOBoxGui.Enabled = false

local UFONameGui = Instance.new("ScreenGui")
UFONameGui.Name = "UFONames"
UFONameGui.IgnoreGuiInset = true
UFONameGui.DisplayOrder = 1002
UFONameGui.ResetOnSpawn = false
UFONameGui.Parent = SpaceHubESPFolder
UFONameGui.Enabled = false

local UFOTrackedModels = {}

local function makeUFOLineFrame()
	local UFOLineFrame = Instance.new("Frame")
	UFOLineFrame.Size = UDim2.fromOffset(10, UFO_LINE_THICKNESS)
	UFOLineFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	UFOLineFrame.BorderSizePixel = 0
	UFOLineFrame.BackgroundColor3 = UFO_DEFAULT_COLOR
	UFOLineFrame.Visible = false
	UFOLineFrame.Parent = UFOLineGui
	return UFOLineFrame
end

local function makeUFOBoxFrame()
	local UFOBoxFrame = Instance.new("Frame")
	UFOBoxFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	UFOBoxFrame.BackgroundTransparency = 1
	UFOBoxFrame.Visible = false
	UFOBoxFrame.Parent = UFOBoxGui

	local UFOBoxAspect = Instance.new("UIAspectRatioConstraint")
	UFOBoxAspect.AspectRatio = 1
	UFOBoxAspect.Parent = UFOBoxFrame

	local UFOBoxStroke = Instance.new("UIStroke")
	UFOBoxStroke.Thickness = 1.5
	UFOBoxStroke.Color = UFO_DEFAULT_COLOR
	UFOBoxStroke.Parent = UFOBoxFrame

	return UFOBoxFrame
end

local function makeUFONameLabel()
	local UFONameLabel = Instance.new("TextLabel")
	UFONameLabel.AnchorPoint = Vector2.new(0.5, 1)
	UFONameLabel.BackgroundTransparency = 1
	UFONameLabel.TextColor3 = UFO_DEFAULT_COLOR
	UFONameLabel.TextScaled = true
	UFONameLabel.Font = Enum.Font.Gotham
	UFONameLabel.Visible = false
	UFONameLabel.Parent = UFONameGui

	local UFONameAspect = Instance.new("UIAspectRatioConstraint")
	UFONameAspect.AspectRatio = 5
	UFONameAspect.Parent = UFONameLabel

	return UFONameLabel
end

local function ufogetModelPosition(model)
	local main = model:FindFirstChild("Main")
	if main and main:IsA("BasePart") then
		return main.Position
	end
	local cf,_ = model:GetBoundingBox()
	return cf.Position
end

local function isPlayerSittingOnModel(model)
	for _, player in pairs(Players:GetPlayers()) do
		if player.Character then
			local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
			if humanoid then
				local seat = humanoid.SeatPart
				if seat and seat:IsDescendantOf(model) then
					return true
				end
			end
		end
	end
	return false
end

local function addUFOModel(model)
	if model:IsA("Model") and not UFOTrackedModels[model] then
		UFOTrackedModels[model] = {
			UFOLineFrame = makeUFOLineFrame(),
			UFOBoxFrame = makeUFOBoxFrame(),
			UFONameLabel = makeUFONameLabel()
		}
	end
end

local function bindSpecialRockets(specialRockets)
	for _, m in ipairs(specialRockets:GetChildren()) do
		addUFOModel(m)
	end
	specialRockets.ChildAdded:Connect(addUFOModel)
end

local specialRockets = workspace:FindFirstChild("SpecialRockets")
if specialRockets then
	bindSpecialRockets(specialRockets)
end

workspace.ChildAdded:Connect(function(obj)
	if obj.Name == "SpecialRockets" then
		bindSpecialRockets(obj)
	end
end)

RunService.RenderStepped:Connect(function()
	local UFOViewport = Camera.ViewportSize
	local UFOSourceX = UFOViewport.X / 2
	local UFOSourceY = UFO_OFFSET_Y

	for model, UFOData in pairs(UFOTrackedModels) do
		local UFOLineFrame = UFOData.UFOLineFrame
		local UFOBoxFrame = UFOData.UFOBoxFrame
		local UFONameLabel = UFOData.UFONameLabel

		if model.Parent and not isPlayerSittingOnModel(model) then
			local UFOWorldPos = ufogetModelPosition(model)
			local UFOScreenPos, UFOVisible = Camera:WorldToViewportPoint(UFOWorldPos)

			if UFOVisible then
				local UFODX = UFOScreenPos.X - UFOSourceX
				local UFODY = UFOScreenPos.Y - UFOSourceY
				local UFODistance = math.sqrt(UFODX^2 + UFODY^2)

				UFOLineFrame.Visible = true
				UFOLineFrame.Size = UDim2.fromOffset(UFODistance, UFO_LINE_THICKNESS)
				UFOLineFrame.Position = UDim2.fromOffset((UFOScreenPos.X + UFOSourceX)/2, (UFOScreenPos.Y + UFOSourceY)/2)
				UFOLineFrame.Rotation = math.deg(math.atan2(UFODY, UFODX))

				local UFOScale = math.clamp(UFOScreenPos.Z / 400, 0.01, 0.045)
				UFOBoxFrame.Visible = true
				UFOBoxFrame.Position = UDim2.fromOffset(UFOScreenPos.X, UFOScreenPos.Y)
				UFOBoxFrame.Size = UDim2.fromScale(UFOScale, UFOScale)

				if UFONameLabel then
					local UFODistanceText = math.floor((Camera.CFrame.Position - UFOWorldPos).Magnitude)
					local UFOName = (model.Name == "AlienShip1" and "UFO 1") or (model.Name == "AlienShip2" and "UFO 2") or model.Name
					local UFOSpeed = model:GetAttribute("speedNeeded") or 0

					local UFOCargoFolder = model:FindFirstChild("Cargo")
					local UFOCargoText = "None"
					if UFOCargoFolder then
						local items = {}
						for _, cfg in ipairs(UFOCargoFolder:GetChildren()) do
							table.insert(items, cfg.Name)
						end
						if #items > 0 then
							UFOCargoText = table.concat(items, ", ")
						end
					end

					UFONameLabel.Text = UFOName.." | "..UFODistanceText.." studs | Speed: "..UFOSpeed.." | Cargo: "..UFOCargoText
					UFONameLabel.Position = UDim2.fromOffset(UFOScreenPos.X, UFOScreenPos.Y - 12.5)
					local UFONameLabelScale = math.clamp(UFOScreenPos.Z / 400, 0.1, 0.1)
					UFONameLabel.Size = UDim2.fromScale(UFONameLabelScale, UFONameLabelScale)
					UFONameLabel.Visible = true
				end
			else
				UFOLineFrame.Visible = false
				UFOBoxFrame.Visible = false
				if UFONameLabel then UFONameLabel.Visible = false end
			end
		else
			UFOLineFrame.Visible = false
			UFOBoxFrame.Visible = false
			if UFONameLabel then UFONameLabel.Visible = false end
		end
	end
end)

-- Orb

local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local CoreGui = game:GetService("CoreGui")

local ORB_LINE_THICKNESS = 1
local ORB_OFFSET_Y = 40
local ORB_DEFAULT_COLOR = Color3.fromRGB(170,170,255)

for _, OrbGuiName in ipairs({ "OrbLines", "OrbBoxes", "OrbNames" }) do
	local OrbOldGui = CoreGui:FindFirstChild(OrbGuiName)
	if OrbOldGui then
		OrbOldGui:Destroy()
	end
end

local OrbLineGui = Instance.new("ScreenGui")
OrbLineGui.Name = "OrbLines"
OrbLineGui.IgnoreGuiInset = true
OrbLineGui.DisplayOrder = 1000
OrbLineGui.ResetOnSpawn = false
OrbLineGui.Parent = SpaceHubESPFolder
OrbLineGui.Enabled = false

local OrbBoxGui = Instance.new("ScreenGui")
OrbBoxGui.Name = "OrbBoxes"
OrbBoxGui.IgnoreGuiInset = true
OrbBoxGui.DisplayOrder = 1001
OrbBoxGui.ResetOnSpawn = false
OrbBoxGui.Parent = SpaceHubESPFolder
OrbBoxGui.Enabled = false

local OrbNameGui = Instance.new("ScreenGui")
OrbNameGui.Name = "OrbNames"
OrbNameGui.IgnoreGuiInset = true
OrbNameGui.DisplayOrder = 1002
OrbNameGui.ResetOnSpawn = false
OrbNameGui.Parent = SpaceHubESPFolder
OrbNameGui.Enabled = false

local OrbTrackedParts = {}

local function makeOrbLineFrame()
	local OrbLineFrame = Instance.new("Frame")
	OrbLineFrame.Size = UDim2.fromOffset(10, ORB_LINE_THICKNESS)
	OrbLineFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	OrbLineFrame.BorderSizePixel = 0
	OrbLineFrame.BackgroundColor3 = ORB_DEFAULT_COLOR
	OrbLineFrame.Visible = false
	OrbLineFrame.Parent = OrbLineGui
	return OrbLineFrame
end

local function makeOrbBoxFrame()
	local OrbBoxFrame = Instance.new("Frame")
	OrbBoxFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	OrbBoxFrame.BackgroundTransparency = 1
	OrbBoxFrame.Visible = false
	OrbBoxFrame.Parent = OrbBoxGui

	local OrbBoxAspect = Instance.new("UIAspectRatioConstraint")
	OrbBoxAspect.AspectRatio = 1
	OrbBoxAspect.Parent = OrbBoxFrame

	local OrbBoxStroke = Instance.new("UIStroke")
	OrbBoxStroke.Thickness = 1.5
	OrbBoxStroke.Color = ORB_DEFAULT_COLOR
	OrbBoxStroke.Parent = OrbBoxFrame

	return OrbBoxFrame
end

local function makeOrbNameTextLabel()
	local OrbNameTextLabel = Instance.new("TextLabel")
	OrbNameTextLabel.AnchorPoint = Vector2.new(0.5, 1)
	OrbNameTextLabel.BackgroundTransparency = 1
	OrbNameTextLabel.TextColor3 = ORB_DEFAULT_COLOR
	OrbNameTextLabel.TextScaled = true
	OrbNameTextLabel.Font = Enum.Font.Gotham
	OrbNameTextLabel.Visible = false
	OrbNameTextLabel.Parent = OrbNameGui

	local OrbNameAspect = Instance.new("UIAspectRatioConstraint")
	OrbNameAspect.AspectRatio = 5
	OrbNameAspect.Parent = OrbNameTextLabel

	return OrbNameTextLabel
end

local function addOrbPart(OrbPart)
	if OrbPart:IsA("BasePart")
		and OrbPart.Name:match("Orb$")
		and not OrbTrackedParts[OrbPart] then

		local OrbHitpoints = OrbPart:GetAttribute("hitpoints") or 0
		if OrbHitpoints > 0 then
			OrbTrackedParts[OrbPart] = {
				OrbLineFrame = makeOrbLineFrame(),
				OrbBoxFrame = makeOrbBoxFrame(),
				OrbNameLabel = makeOrbNameTextLabel()
			}
		end
	end
end

local function bindOrbPlanets(OrbPlanetsFolder)
	for _, OrbPlanet in ipairs(OrbPlanetsFolder:GetChildren()) do
		local OrbMinerals = OrbPlanet:FindFirstChild("Minerals")
		if OrbMinerals then
			for _, OrbPart in ipairs(OrbMinerals:GetChildren()) do
				addOrbPart(OrbPart)
			end
			OrbMinerals.ChildAdded:Connect(addOrbPart)
		end
	end
end

local OrbPlanetsRoot = workspace:FindFirstChild("Planets")
if OrbPlanetsRoot then
	bindOrbPlanets(OrbPlanetsRoot)
end

workspace.ChildAdded:Connect(function(OrbChild)
	if OrbChild.Name == "Planets" then
		bindOrbPlanets(OrbChild)
	end
end)

RunService.RenderStepped:Connect(function()
	local OrbViewport = Camera.ViewportSize
	local OrbSourceX = OrbViewport.X / 2
	local OrbSourceY = ORB_OFFSET_Y

	for OrbPart, OrbData in pairs(OrbTrackedParts) do
		local OrbLineFrame = OrbData.OrbLineFrame
		local OrbBoxFrame = OrbData.OrbBoxFrame
		local OrbNameLabel = OrbData.OrbNameLabel

		if OrbPart.Parent then
			local OrbWorldPos = OrbPart.Position
			local OrbScreenPos, OrbVisible =
				Camera:WorldToViewportPoint(OrbWorldPos)

			if OrbVisible then
				local OrbDX = OrbScreenPos.X - OrbSourceX
				local OrbDY = OrbScreenPos.Y - OrbSourceY
				local OrbDistance = math.sqrt(OrbDX^2 + OrbDY^2)

				OrbLineFrame.Visible = true
				OrbLineFrame.Size =
					UDim2.fromOffset(OrbDistance, ORB_LINE_THICKNESS)
				OrbLineFrame.Position = UDim2.fromOffset(
					(OrbScreenPos.X + OrbSourceX) / 2,
					(OrbScreenPos.Y + OrbSourceY) / 2
				)
				OrbLineFrame.Rotation =
					math.deg(math.atan2(OrbDY, OrbDX))

				local OrbScale =
					math.clamp(OrbScreenPos.Z / 400, 0.01, 0.03)
				OrbBoxFrame.Visible = true
				OrbBoxFrame.Position =
					UDim2.fromOffset(OrbScreenPos.X, OrbScreenPos.Y)
				OrbBoxFrame.Size =
					UDim2.fromScale(OrbScale, OrbScale)

				local OrbDistanceText =
					math.floor((Camera.CFrame.Position - OrbWorldPos).Magnitude)

				OrbNameLabel.Text =
					OrbPart.Name .. " | " .. OrbDistanceText .. " studs"
				OrbNameLabel.Position =
					UDim2.fromOffset(OrbScreenPos.X, OrbScreenPos.Y - 10)

				local OrbLabelScale =
					math.clamp(OrbScreenPos.Z / 400, 0.1, 0.125)
				OrbNameLabel.Size =
					UDim2.fromScale(OrbLabelScale, OrbLabelScale)
				OrbNameLabel.Visible = true
			else
				OrbLineFrame.Visible = false
				OrbBoxFrame.Visible = false
				OrbNameLabel.Visible = false
			end
		else
			OrbLineFrame.Visible = false
			OrbBoxFrame.Visible = false
			OrbNameLabel.Visible = false
		end
	end
end)

-- Resources 

local RESOURCE_LINE_THICKNESS = 1
local RESOURCE_OFFSET_Y = 40

local RESOURCE_COLOR_GRAY = Color3.fromRGB(170,170,170)
local RESOURCE_COLOR_YELLOW = Color3.fromRGB(255,255,0)
local RESOURCE_COLOR_RED = Color3.fromRGB(255,0,0)

for _, ResourceGuiName in ipairs({ "ResourceLines", "ResourceBoxes", "ResourceNames" }) do
	local ResourceOldGui = CoreGui:FindFirstChild(ResourceGuiName)
	if ResourceOldGui then
		ResourceOldGui:Destroy()
	end
end

local ResourceLineGui = Instance.new("ScreenGui")
ResourceLineGui.Name = "ResourceLines"
ResourceLineGui.IgnoreGuiInset = true
ResourceLineGui.DisplayOrder = 1000
ResourceLineGui.ResetOnSpawn = false
ResourceLineGui.Parent = SpaceHubESPFolder
ResourceLineGui.Enabled = false

local ResourceBoxGui = Instance.new("ScreenGui")
ResourceBoxGui.Name = "ResourceBoxes"
ResourceBoxGui.IgnoreGuiInset = true
ResourceBoxGui.DisplayOrder = 1001
ResourceBoxGui.ResetOnSpawn = false
ResourceBoxGui.Parent = SpaceHubESPFolder
ResourceBoxGui.Enabled = false

local ResourceNameGui = Instance.new("ScreenGui")
ResourceNameGui.Name = "ResourceNames"
ResourceNameGui.IgnoreGuiInset = true
ResourceNameGui.DisplayOrder = 1002
ResourceNameGui.ResetOnSpawn = false
ResourceNameGui.Parent = SpaceHubESPFolder
ResourceNameGui.Enabled = false

local ResourceTrackedParts = {}

local function getResourceHpColor(ResourceHP)
	if not ResourceHP then
		return RESOURCE_COLOR_GRAY
	elseif ResourceHP < 40 then
		return RESOURCE_COLOR_RED
	elseif ResourceHP < 60 then
		return RESOURCE_COLOR_YELLOW
	else
		return RESOURCE_COLOR_GRAY
	end
end

local function makeResourceLineFrame()
	local ResourceLineFrame = Instance.new("Frame")
	ResourceLineFrame.Size = UDim2.fromOffset(10, RESOURCE_LINE_THICKNESS)
	ResourceLineFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	ResourceLineFrame.BorderSizePixel = 0
	ResourceLineFrame.Visible = false
	ResourceLineFrame.Parent = ResourceLineGui
	return ResourceLineFrame
end

local function makeResourceBoxFrame()
	local ResourceBoxFrame = Instance.new("Frame")
	ResourceBoxFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	ResourceBoxFrame.BackgroundTransparency = 1
	ResourceBoxFrame.Visible = false
	ResourceBoxFrame.Parent = ResourceBoxGui

	local ResourceBoxAspect = Instance.new("UIAspectRatioConstraint")
	ResourceBoxAspect.AspectRatio = 1
	ResourceBoxAspect.Parent = ResourceBoxFrame

	local ResourceBoxStroke = Instance.new("UIStroke")
	ResourceBoxStroke.Thickness = 1.5
	ResourceBoxStroke.Parent = ResourceBoxFrame

	return ResourceBoxFrame
end

local function makeResourceNameTextLabel()
	local ResourceNameTextLabel = Instance.new("TextLabel")
	ResourceNameTextLabel.AnchorPoint = Vector2.new(0.5, 1)
	ResourceNameTextLabel.BackgroundTransparency = 1
	ResourceNameTextLabel.TextScaled = true
	ResourceNameTextLabel.Font = Enum.Font.Gotham
	ResourceNameTextLabel.Visible = false
	ResourceNameTextLabel.Parent = ResourceNameGui

	local ResourceNameAspect = Instance.new("UIAspectRatioConstraint")
	ResourceNameAspect.AspectRatio = 5
	ResourceNameAspect.Parent = ResourceNameTextLabel

	return ResourceNameTextLabel
end

local function addResourcePart(ResourcePart)
	if not ResourcePart:IsA("BasePart") then return end
	if ResourcePart.Name:match("Orb$") then return end
	if ResourceTrackedParts[ResourcePart] then return end

	ResourceTrackedParts[ResourcePart] = {
		ResourceLineFrame = makeResourceLineFrame(),
		ResourceBoxFrame = makeResourceBoxFrame(),
		ResourceNameLabel = makeResourceNameTextLabel(),
		ResourceParentPlanet = ResourcePart.Parent and ResourcePart.Parent.Parent
	}
end

local function bindResourcePlanets(ResourcePlanetsFolder)
	for _, ResourcePlanet in ipairs(ResourcePlanetsFolder:GetChildren()) do
		local ResourceMinerals = ResourcePlanet:FindFirstChild("Minerals")
		if ResourceMinerals then
			for _, ResourcePart in ipairs(ResourceMinerals:GetChildren()) do
				addResourcePart(ResourcePart)
			end
			ResourceMinerals.ChildAdded:Connect(addResourcePart)
		end
	end
end

local ResourcePlanetsRoot = workspace:FindFirstChild("Planets")
if ResourcePlanetsRoot then
	bindResourcePlanets(ResourcePlanetsRoot)
end

workspace.ChildAdded:Connect(function(ResourceChild)
	if ResourceChild.Name == "Planets" then
		bindResourcePlanets(ResourceChild)
	end
end)

RunService.RenderStepped:Connect(function()
	local ResourceViewport = Camera.ViewportSize
	local ResourceSourceX = ResourceViewport.X / 2
	local ResourceSourceY = RESOURCE_OFFSET_Y

	local ResourceCharacter = LocalPlayer.Character
	local ResourceHRP = ResourceCharacter and ResourceCharacter:FindFirstChild("HumanoidRootPart")
	if not ResourceHRP then return end

	for ResourcePart, ResourceData in pairs(ResourceTrackedParts) do
		local ResourceLineFrame = ResourceData.ResourceLineFrame
		local ResourceBoxFrame = ResourceData.ResourceBoxFrame
		local ResourceNameLabel = ResourceData.ResourceNameLabel
		local ResourcePlanet = ResourceData.ResourceParentPlanet
		local ResourceSkin = ResourcePlanet and ResourcePlanet:FindFirstChild("Skin")
		local ResourceHP = ResourcePart:GetAttribute("hitpoints")

		local ResourceInsideSkin = false
		if ResourceSkin and ResourceSkin:IsA("BasePart") then
			local ResourceRadius = ResourceSkin.Size.X / 2
			ResourceInsideSkin =
				(ResourceHRP.Position - ResourceSkin.Position).Magnitude <= ResourceRadius
		end

		if ResourcePart.Parent and ResourceSkin and ResourceHP and ResourceHP > 0 and ResourceInsideSkin then
			local ResourceScreenPos, ResourceVisible =
				Camera:WorldToViewportPoint(ResourcePart.Position)

			if ResourceVisible then
				local ResourceColor = getResourceHpColor(ResourceHP)

				ResourceLineFrame.BackgroundColor3 = ResourceColor
				ResourceBoxFrame.UIStroke.Color = ResourceColor
				ResourceNameLabel.TextColor3 = ResourceColor

				local ResourceDX = ResourceScreenPos.X - ResourceSourceX
				local ResourceDY = ResourceScreenPos.Y - ResourceSourceY
				local ResourceDistance = math.sqrt(ResourceDX^2 + ResourceDY^2)

				ResourceLineFrame.Visible = true
				ResourceLineFrame.Size =
					UDim2.fromOffset(ResourceDistance, RESOURCE_LINE_THICKNESS)
				ResourceLineFrame.Position = UDim2.fromOffset(
					(ResourceScreenPos.X + ResourceSourceX) / 2,
					(ResourceScreenPos.Y + ResourceSourceY) / 2
				)
				ResourceLineFrame.Rotation =
					math.deg(math.atan2(ResourceDY, ResourceDX))

				local ResourceScale =
					math.clamp(ResourceScreenPos.Z / 400, 0.01, 0.045)
				ResourceBoxFrame.Visible = true
				ResourceBoxFrame.Position =
					UDim2.fromOffset(ResourceScreenPos.X, ResourceScreenPos.Y)
				ResourceBoxFrame.Size =
					UDim2.fromScale(ResourceScale, ResourceScale)

				local ResourceIdName =
					ResourcePart:GetAttribute("idName") or ResourcePart.Name
				local ResourceDistText =
					math.floor((ResourceHRP.Position - ResourcePart.Position).Magnitude)

				ResourceNameLabel.Text =
					ResourceIdName .. " | " .. ResourceDistText .. " studs"
				ResourceNameLabel.Position =
					UDim2.fromOffset(ResourceScreenPos.X, ResourceScreenPos.Y - 12.5)
				ResourceNameLabel.Size = UDim2.fromScale(0.1, 0.1)
				ResourceNameLabel.Visible = true
			else
				ResourceLineFrame.Visible = false
				ResourceBoxFrame.Visible = false
				ResourceNameLabel.Visible = false
			end
		else
			ResourceLineFrame.Visible = false
			ResourceBoxFrame.Visible = false
			ResourceNameLabel.Visible = false
		end
	end
end)

-- Artifacts

local ARTIFACT_LINE_THICKNESS = 1
local ARTIFACT_OFFSET_Y = 40

local ARTIFACT_RARITY_COLORS = {
	Common = Color3.fromRGB(255,127,80),
	Rare = Color3.fromRGB(0,170,0),
	Epic = Color3.fromRGB(0,0,139),
	Legendary = Color3.fromRGB(255,170,0),
	Mythic = Color3.fromRGB(170,0,255)
}

for _, ArtifactGuiName in ipairs({ "ArtifactLines", "ArtifactBoxes", "ArtifactNames" }) do
	local ArtifactOldGui = CoreGui:FindFirstChild(ArtifactGuiName)
	if ArtifactOldGui then
		ArtifactOldGui:Destroy()
	end
end

local ArtifactLineGui = Instance.new("ScreenGui")
ArtifactLineGui.Name = "ArtifactLines"
ArtifactLineGui.IgnoreGuiInset = true
ArtifactLineGui.DisplayOrder = 1000
ArtifactLineGui.ResetOnSpawn = false
ArtifactLineGui.Parent = SpaceHubESPFolder
ArtifactLineGui.Enabled = false

local ArtifactBoxGui = Instance.new("ScreenGui")
ArtifactBoxGui.Name = "ArtifactBoxes"
ArtifactBoxGui.IgnoreGuiInset = true
ArtifactBoxGui.DisplayOrder = 1001
ArtifactBoxGui.ResetOnSpawn = false
ArtifactBoxGui.Parent = SpaceHubESPFolder
ArtifactBoxGui.Enabled = false

local ArtifactNameGui = Instance.new("ScreenGui")
ArtifactNameGui.Name = "ArtifactNames"
ArtifactNameGui.IgnoreGuiInset = true
ArtifactNameGui.DisplayOrder = 1002
ArtifactNameGui.ResetOnSpawn = false
ArtifactNameGui.Parent = SpaceHubESPFolder
ArtifactNameGui.Enabled = false

local ArtifactTrackedParts = {}

local function makeArtifactLineFrame()
	local ArtifactLineFrame = Instance.new("Frame")
	ArtifactLineFrame.Size = UDim2.fromOffset(10, ARTIFACT_LINE_THICKNESS)
	ArtifactLineFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	ArtifactLineFrame.BorderSizePixel = 0
	ArtifactLineFrame.Visible = false
	ArtifactLineFrame.Parent = ArtifactLineGui
	return ArtifactLineFrame
end

local function makeArtifactBoxFrame()
	local ArtifactBoxFrame = Instance.new("Frame")
	ArtifactBoxFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	ArtifactBoxFrame.BackgroundTransparency = 1
	ArtifactBoxFrame.Visible = false
	ArtifactBoxFrame.Parent = ArtifactBoxGui

	local ArtifactBoxAspect = Instance.new("UIAspectRatioConstraint")
	ArtifactBoxAspect.AspectRatio = 1
	ArtifactBoxAspect.Parent = ArtifactBoxFrame

	local ArtifactBoxStroke = Instance.new("UIStroke")
	ArtifactBoxStroke.Thickness = 1.5
	ArtifactBoxStroke.Parent = ArtifactBoxFrame

	return ArtifactBoxFrame
end

local function makeArtifactNameTextLabel()
	local ArtifactNameTextLabel = Instance.new("TextLabel")
	ArtifactNameTextLabel.AnchorPoint = Vector2.new(0.5, 1)
	ArtifactNameTextLabel.BackgroundTransparency = 1
	ArtifactNameTextLabel.TextScaled = true
	ArtifactNameTextLabel.Font = Enum.Font.Gotham
	ArtifactNameTextLabel.Visible = false
	ArtifactNameTextLabel.Parent = ArtifactNameGui

	local ArtifactNameAspect = Instance.new("UIAspectRatioConstraint")
	ArtifactNameAspect.AspectRatio = 5
	ArtifactNameAspect.Parent = ArtifactNameTextLabel

	return ArtifactNameTextLabel
end

local function getArtifactWorldPosition(ArtifactObject)
	if ArtifactObject:IsA("BasePart") then
		return ArtifactObject.Position
	end
	local ArtifactCF, _ = ArtifactObject:GetBoundingBox()
	return ArtifactCF.Position
end

local function addArtifactPart(ArtifactPart)
	if not ArtifactPart:IsA("BasePart") then return end
	if ArtifactTrackedParts[ArtifactPart] then return end

	ArtifactTrackedParts[ArtifactPart] = {
		ArtifactLineFrame = makeArtifactLineFrame(),
		ArtifactBoxFrame = makeArtifactBoxFrame(),
		ArtifactNameLabel = makeArtifactNameTextLabel(),
		ArtifactParentPlanet = ArtifactPart.Parent and ArtifactPart.Parent.Parent
	}
end

local function bindArtifactPlanets(ArtifactPlanetsFolder)
	for _, ArtifactPlanet in ipairs(ArtifactPlanetsFolder:GetChildren()) do
		local ArtifactFolder = ArtifactPlanet:FindFirstChild("Artifacts")
		if ArtifactFolder then
			for _, ArtifactPart in ipairs(ArtifactFolder:GetChildren()) do
				addArtifactPart(ArtifactPart)
			end
			ArtifactFolder.ChildAdded:Connect(addArtifactPart)
		end
	end
end

local ArtifactPlanetsRoot = workspace:FindFirstChild("Planets")
if ArtifactPlanetsRoot then
	bindArtifactPlanets(ArtifactPlanetsRoot)
end

workspace.ChildAdded:Connect(function(ArtifactChild)
	if ArtifactChild.Name == "Planets" then
		bindArtifactPlanets(ArtifactChild)
	end
end)

RunService.RenderStepped:Connect(function()
	local ArtifactViewport = Camera.ViewportSize
	local ArtifactSourceX = ArtifactViewport.X / 2
	local ArtifactSourceY = ARTIFACT_OFFSET_Y

	local ArtifactCharacter = LocalPlayer.Character
	local ArtifactHRP = ArtifactCharacter and ArtifactCharacter:FindFirstChild("HumanoidRootPart")
	if not ArtifactHRP then return end

	for ArtifactPart, ArtifactData in pairs(ArtifactTrackedParts) do
		local ArtifactLineFrame = ArtifactData.ArtifactLineFrame
		local ArtifactBoxFrame = ArtifactData.ArtifactBoxFrame
		local ArtifactNameLabel = ArtifactData.ArtifactNameLabel
		local ArtifactPlanet = ArtifactData.ArtifactParentPlanet
		local ArtifactSkin = ArtifactPlanet and ArtifactPlanet:FindFirstChild("Skin")

		local ArtifactInsideSkin = false
		if ArtifactSkin and ArtifactSkin:IsA("BasePart") then
			ArtifactInsideSkin =
				(ArtifactHRP.Position - ArtifactSkin.Position).Magnitude
				<= (ArtifactSkin.Size.X / 2)
		end

		if ArtifactPart.Parent and ArtifactInsideSkin then
			local ArtifactScreenPos, ArtifactVisible =
				Camera:WorldToViewportPoint(getArtifactWorldPosition(ArtifactPart))

			if ArtifactVisible then
				local ArtifactRarity = ArtifactPart:GetAttribute("rarity")
				local ArtifactColor =
					ARTIFACT_RARITY_COLORS[ArtifactRarity] or Color3.fromRGB(255,255,255)

				ArtifactLineFrame.BackgroundColor3 = ArtifactColor
				ArtifactBoxFrame.UIStroke.Color = ArtifactColor
				ArtifactNameLabel.TextColor3 = ArtifactColor

				local ArtifactDX = ArtifactScreenPos.X - ArtifactSourceX
				local ArtifactDY = ArtifactScreenPos.Y - ArtifactSourceY
				local ArtifactDistance = math.sqrt(ArtifactDX^2 + ArtifactDY^2)

				ArtifactLineFrame.Visible = true
				ArtifactLineFrame.Size = UDim2.fromOffset(ArtifactDistance, ARTIFACT_LINE_THICKNESS)
				ArtifactLineFrame.Position = UDim2.fromOffset(
					(ArtifactScreenPos.X + ArtifactSourceX) / 2,
					(ArtifactScreenPos.Y + ArtifactSourceY) / 2
				)
				ArtifactLineFrame.Rotation = math.deg(math.atan2(ArtifactDY, ArtifactDX))

				local ArtifactScale = math.clamp(ArtifactScreenPos.Z / 400, 0.01, 0.045)
				ArtifactBoxFrame.Visible = true
				ArtifactBoxFrame.Position =
					UDim2.fromOffset(ArtifactScreenPos.X, ArtifactScreenPos.Y)
				ArtifactBoxFrame.Size =
					UDim2.fromScale(ArtifactScale, ArtifactScale)

				local ArtifactType =
					ArtifactPart:GetAttribute("aType") or ArtifactPart.Name
				local ArtifactMass =
					ArtifactPart:GetAttribute("mass") or 0
				local ArtifactDistText =
					math.floor((ArtifactHRP.Position -
						getArtifactWorldPosition(ArtifactPart)).Magnitude)

				ArtifactNameLabel.Text =
					ArtifactType ..
					" | " .. ArtifactMass ..
					" Kg | " .. (ArtifactRarity or "Unknown") ..
					" | " .. ArtifactDistText .. " studs"

				ArtifactNameLabel.Position =
					UDim2.fromOffset(ArtifactScreenPos.X, ArtifactScreenPos.Y - 12.5)
				ArtifactNameLabel.Size = UDim2.fromScale(0.1, 0.1)
				ArtifactNameLabel.Visible = true
			else
				ArtifactLineFrame.Visible = false
				ArtifactBoxFrame.Visible = false
				ArtifactNameLabel.Visible = false
			end
		else
			ArtifactLineFrame.Visible = false
			ArtifactBoxFrame.Visible = false
			ArtifactNameLabel.Visible = false
		end
	end
end)

-- Centaur

local CENTAUR_LINE_THICKNESS = 1
local CENTAUR_OFFSET_Y = 40
local CENTAUR_DEFAULT_COLOR = Color3.fromRGB(255,170,127)

for _, CentaurGuiName in ipairs({ "CentaurLines", "CentaurBoxes", "CentaurNames" }) do
	local CentaurOldGui = CoreGui:FindFirstChild(CentaurGuiName)
	if CentaurOldGui then
		CentaurOldGui:Destroy()
	end
end

local CentaurLineGui = Instance.new("ScreenGui")
CentaurLineGui.Name = "CentaurLines"
CentaurLineGui.IgnoreGuiInset = true
CentaurLineGui.DisplayOrder = 1000
CentaurLineGui.ResetOnSpawn = false
CentaurLineGui.Parent = SpaceHubESPFolder
CentaurLineGui.Enabled = false

local CentaurBoxGui = Instance.new("ScreenGui")
CentaurBoxGui.Name = "CentaurBoxes"
CentaurBoxGui.IgnoreGuiInset = true
CentaurBoxGui.DisplayOrder = 1001
CentaurBoxGui.ResetOnSpawn = false
CentaurBoxGui.Parent = SpaceHubESPFolder
CentaurBoxGui.Enabled = false

local CentaurNameGui = Instance.new("ScreenGui")
CentaurNameGui.Name = "CentaurNames"
CentaurNameGui.IgnoreGuiInset = true
CentaurNameGui.DisplayOrder = 1002
CentaurNameGui.ResetOnSpawn = false
CentaurNameGui.Parent = SpaceHubESPFolder
CentaurNameGui.Enabled = false

local CentaurTrackedModels = {}

local function makeCentaurLineFrame()
	local CentaurLineFrame = Instance.new("Frame")
	CentaurLineFrame.Size = UDim2.fromOffset(10, CENTAUR_LINE_THICKNESS)
	CentaurLineFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	CentaurLineFrame.BorderSizePixel = 0
	CentaurLineFrame.BackgroundColor3 = CENTAUR_DEFAULT_COLOR
	CentaurLineFrame.Visible = false
	CentaurLineFrame.Parent = CentaurLineGui
	return CentaurLineFrame
end

local function makeCentaurBoxFrame()
	local CentaurBoxFrame = Instance.new("Frame")
	CentaurBoxFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	CentaurBoxFrame.BackgroundTransparency = 1
	CentaurBoxFrame.Visible = false
	CentaurBoxFrame.Parent = CentaurBoxGui

	local CentaurBoxAspect = Instance.new("UIAspectRatioConstraint")
	CentaurBoxAspect.AspectRatio = 1
	CentaurBoxAspect.Parent = CentaurBoxFrame

	local CentaurBoxStroke = Instance.new("UIStroke")
	CentaurBoxStroke.Thickness = 1.5
	CentaurBoxStroke.Color = CENTAUR_DEFAULT_COLOR
	CentaurBoxStroke.Parent = CentaurBoxFrame

	return CentaurBoxFrame
end

local function makeCentaurNameTextLabel()
	local CentaurNameTextLabel = Instance.new("TextLabel")
	CentaurNameTextLabel.AnchorPoint = Vector2.new(0.5, 1)
	CentaurNameTextLabel.BackgroundTransparency = 1
	CentaurNameTextLabel.TextColor3 = CENTAUR_DEFAULT_COLOR
	CentaurNameTextLabel.TextScaled = true
	CentaurNameTextLabel.Font = Enum.Font.Gotham
	CentaurNameTextLabel.Visible = false
	CentaurNameTextLabel.Parent = CentaurNameGui

	local CentaurNameAspect = Instance.new("UIAspectRatioConstraint")
	CentaurNameAspect.AspectRatio = 5
	CentaurNameAspect.Parent = CentaurNameTextLabel

	return CentaurNameTextLabel
end

local function getCentaurModelWorldPosition(CentaurModel)
	local CentaurCF, _ = CentaurModel:GetBoundingBox()
	return CentaurCF.Position
end

local function addCentaurModelToTrack(CentaurModel)
	if CentaurModel:IsA("Model") and not CentaurTrackedModels[CentaurModel] then
		CentaurTrackedModels[CentaurModel] = {
			CentaurLineFrame = makeCentaurLineFrame(),
			CentaurBoxFrame = makeCentaurBoxFrame(),
			CentaurNameLabel = makeCentaurNameTextLabel()
		}

		local CentaurMineralsFolder = CentaurModel:FindFirstChild("Minerals")
		if CentaurMineralsFolder then
			for _, CentaurMineral in ipairs(CentaurMineralsFolder:GetChildren()) do
				if CentaurMineral:GetAttribute("hitpoints") then
					CentaurMineral:GetAttributeChangedSignal("hitpoints"):Connect(function()
						local CentaurAlive = false
						for _, CentaurCheck in ipairs(CentaurMineralsFolder:GetChildren()) do
							local CentaurHP = CentaurCheck:GetAttribute("hitpoints")
							if type(CentaurHP) == "number" and CentaurHP > 0 then
								CentaurAlive = true
								break
							end
						end

						if not CentaurAlive then
							local CentaurData = CentaurTrackedModels[CentaurModel]
							CentaurData.CentaurLineFrame.Visible = false
							CentaurData.CentaurBoxFrame.Visible = false
							CentaurData.CentaurNameLabel.Visible = false
						end
					end)
				end
			end
		end
	end
end

local function bindCentaurFolder(CentaurFolder)
	for _, CentaurModel in ipairs(CentaurFolder:GetChildren()) do
		addCentaurModelToTrack(CentaurModel)
	end
	CentaurFolder.ChildAdded:Connect(addCentaurModelToTrack)
end

local function findCentaurRootFolder()
	local CentaurRoot = workspace:FindFirstChild("Centaurs")
	if CentaurRoot then
		bindCentaurFolder(CentaurRoot)
	end
end

findCentaurRootFolder()

workspace.ChildAdded:Connect(function(Child)
	if Child.Name == "Centaurs" then
		bindCentaurFolder(Child)
	end
end)

RunService.RenderStepped:Connect(function()
	local CentaurViewport = Camera.ViewportSize
	local CentaurSourceX = CentaurViewport.X / 2
	local CentaurSourceY = CENTAUR_OFFSET_Y

	for CentaurModel, CentaurData in pairs(CentaurTrackedModels) do
		local CentaurLineFrame = CentaurData.CentaurLineFrame
		local CentaurBoxFrame = CentaurData.CentaurBoxFrame
		local CentaurNameLabel = CentaurData.CentaurNameLabel

		if CentaurModel.Parent then
			local CentaurMineralsFolder = CentaurModel:FindFirstChild("Minerals")
			local CentaurHasAlive = false
			local CentaurResourcesText = "None"
			local CentaurColor = CENTAUR_DEFAULT_COLOR

			if CentaurMineralsFolder then
				local CentaurItems = {}
				for _, CentaurMineral in ipairs(CentaurMineralsFolder:GetChildren()) do
					local CentaurHP = CentaurMineral:GetAttribute("hitpoints")
					if type(CentaurHP) == "number" and CentaurHP > 0 then
						CentaurHasAlive = true
						table.insert(CentaurItems, CentaurMineral.Name)

						if CentaurMineral.Name == "Mythic Crate" then
							CentaurColor = Color3.fromRGB(128,0,128)
						elseif CentaurMineral.Name == "Legendary Crate" then
							CentaurColor = Color3.fromRGB(255,165,0)
						elseif CentaurMineral.Name == "Epic Crate" then
							CentaurColor = Color3.fromRGB(0,0,139)
						elseif CentaurMineral.Name == "Rare Crate" then
							CentaurColor = Color3.fromRGB(0,100,0)
						else
							CentaurColor = CENTAUR_DEFAULT_COLOR
						end
					end
				end

				if #CentaurItems > 0 then
					CentaurResourcesText = table.concat(CentaurItems, ", ")
				end
			end

			if CentaurHasAlive then
				local CentaurWorldPos = getCentaurModelWorldPosition(CentaurModel)
				local CentaurScreenPos, CentaurVisible = Camera:WorldToViewportPoint(CentaurWorldPos)

				if CentaurVisible then
					local CentaurDX = CentaurScreenPos.X - CentaurSourceX
					local CentaurDY = CentaurScreenPos.Y - CentaurSourceY
					local CentaurDistance = math.sqrt(CentaurDX^2 + CentaurDY^2)

					CentaurLineFrame.Visible = true
					CentaurLineFrame.Size = UDim2.fromOffset(CentaurDistance, CENTAUR_LINE_THICKNESS)
					CentaurLineFrame.Position = UDim2.fromOffset(
						(CentaurScreenPos.X + CentaurSourceX) / 2,
						(CentaurScreenPos.Y + CentaurSourceY) / 2
					)
					CentaurLineFrame.Rotation = math.deg(math.atan2(CentaurDY, CentaurDX))
					CentaurLineFrame.BackgroundColor3 = CentaurColor

					local CentaurScale = math.clamp(CentaurScreenPos.Z / 400, 0.01, 0.045)
					CentaurBoxFrame.Visible = true
					CentaurBoxFrame.Position = UDim2.fromOffset(CentaurScreenPos.X, CentaurScreenPos.Y)
					CentaurBoxFrame.Size = UDim2.fromScale(CentaurScale, CentaurScale)
					CentaurBoxFrame.UIStroke.Color = CentaurColor

					local CentaurDistanceText = math.floor(
						(Camera.CFrame.Position - CentaurWorldPos).Magnitude
					)

					CentaurNameLabel.Text =
						CentaurModel.Name ..
						" | " .. CentaurDistanceText ..
						" studs | Resources: " .. CentaurResourcesText

					CentaurNameLabel.Position = UDim2.fromOffset(
						CentaurScreenPos.X,
						CentaurScreenPos.Y - 12.5
					)
					CentaurNameLabel.Size = UDim2.fromScale(0.1, 0.1)
					CentaurNameLabel.Visible = true
				else
					CentaurLineFrame.Visible = false
					CentaurBoxFrame.Visible = false
					CentaurNameLabel.Visible = false
				end
			else
				CentaurLineFrame.Visible = false
				CentaurBoxFrame.Visible = false
				CentaurNameLabel.Visible = false
			end
		else
			CentaurLineFrame.Visible = false
			CentaurBoxFrame.Visible = false
			CentaurNameLabel.Visible = false
		end
	end
end)
print("Successfully Executed Space Hub ESP Container ")
-------------------------------------------------------------------------- end ------------------
